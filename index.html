<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plastic Surgery Map View</title>

  <!-- ✅ 네이버 지도 API (영문 + geocoder/places 모듈 포함) -->
  <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=YOUR_CLIENT_ID&submodules=geocoder,places&language=en"></script>

  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      margin: 0;
      background: #f5f5f5;
    }
    header {
      background-color: #03c75a;
      color: white;
      padding: 1rem 2rem;
      text-align: center;
      font-size: 1.4rem;
      font-weight: bold;
    }
    .map-container {
      width: 100%;
      height: 60vh;
      position: relative;
      border-bottom: 3px solid #03c75a;
    }

    /* 구글 지도 iframe */
    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* 네이버 지도 영역 */
    #naver-map {
      width: 100%;
      height: 70vh;
      position: relative;
    }

    /* 검색창 스타일 */
    #search-box {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: white;
      padding: 8px 12px;
      border-radius: 8px;
      display: flex;
      gap: 8px;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    #search-input {
      width: 260px;
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #search-button {
      background-color: #03c75a;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    /* 검색 결과 리스트 */
    #results {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      width: 320px;
      max-height: 250px;
      overflow-y: auto;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      z-index: 999;
      display: none;
    }

    .result-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    .result-item:hover {
      background-color: #f8f8f8;
    }
    .result-title {
      font-weight: 600;
    }
    .result-address {
      font-size: 13px;
      color: #666;
    }
  </style>
</head>

<body>
  <header>Best Plastic Surgery Clinics in Korea</header>

  <!-- ✅ 구글 지도 (그대로 유지) -->
  <div class="map-container">
    <iframe src="https://storage.googleapis.com/maps-solutions-cccswt1fsz/neighborhood-discovery/ap9e/neighborhood-discovery.html"
      loading="lazy"
      allowfullscreen>
    </iframe>
  </div>

  <!-- ✅ 네이버 지도 + 검색 기능 -->
  <div id="naver-map"></div>

  <!-- 검색 UI -->
  <div id="search-box">
    <input type="text" id="search-input" placeholder="Search locations (e.g., Gangnam, Apgujeong, etc.)" />
    <button id="search-button">Search</button>
  </div>
  <div id="results"></div>

  <script>
    var map = new naver.maps.Map("naver-map", {
      center: new naver.maps.LatLng(37.5665, 126.9780),
      zoom: 11
    });

    var markers = [];
    var infowindows = [];

    // 지도 위 마커/정보창 초기화
    function clearMap() {
      markers.forEach(m => m.setMap(null));
      infowindows.forEach(iw => iw.close());
      markers = [];
      infowindows = [];
    }

    // 장소 검색
    function searchPlaces(keyword) {
      var ps = new naver.maps.Service();
      ps.geocode({ query: keyword }, function(status, response) {
        if (status !== naver.maps.Service.Status.OK) {
          alert("No search results found.");
          return;
        }

        var places = response.v2.addresses;
        displayResults(places);
      });
    }

    // 결과 리스트 표시
    function displayResults(results) {
      var resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";
      clearMap();

      if (results.length === 0) {
        resultsDiv.style.display = "none";
        alert("No results found.");
        return;
      }

      resultsDiv.style.display = "block";
      results.forEach(function(place, index) {
        var item = document.createElement("div");
        item.className = "result-item";
        item.innerHTML = `
          <div class="result-title">${place.roadAddress || place.jibunAddress}</div>
          <div class="result-address">Lat: ${place.y}, Lng: ${place.x}</div>
        `;
        item.addEventListener("click", function() {
          focusPlace(place);
        });
        resultsDiv.appendChild(item);
      });
    }

    // 특정 장소 포커스
    function focusPlace(place) {
      var lat = parseFloat(place.y);
      var lng = parseFloat(place.x);
      var location = new naver.maps.LatLng(lat, lng);

      map.setCenter(location);
      map.setZoom(15);

      clearMap();

      var marker = new naver.maps.Marker({
        position: location,
        map: map
      });
      markers.push(marker);

      var infoContent = `
        <div style="padding:10px;max-width:200px;">
          <h4 style="margin:0 0 5px;">${place.roadAddress || place.jibunAddress}</h4>
          <p>Latitude: ${lat.toFixed(6)}<br>Longitude: ${lng.toFixed(6)}</p>
        </div>
      `;

      var infowindow = new naver.maps.InfoWindow({
        content: infoContent,
        backgroundColor: "#fff",
        borderColor: "#03c75a",
        borderWidth: 3,
        anchorSize: new naver.maps.Size(20, 20)
      });

      infowindow.open(map, marker);
      infowindows.push(infowindow);

      document.getElementById("results").style.display = "none";
    }

    // 자동완성 (입력 시 실시간)
    var autocompleteTimer;
    document.getElementById("search-input").addEventListener("input", function() {
      clearTimeout(autocompleteTimer);
      var query = this.value.trim();
      if (!query) {
        document.getElementById("results").style.display = "none";
        return;
      }

      autocompleteTimer = setTimeout(function() {
        naver.maps.Service.geocode({ query: query }, function(status, response) {
          if (status !== naver.maps.Service.Status.OK) return;
          var results = response.v2.addresses.slice(0, 5);
          displayResults(results);
        });
      }, 300);
    });

    // 검색 버튼
    document.getElementById("search-button").addEventListener("click", function() {
      var query = document.getElementById("search-input").value.trim();
      if (!query) {
        alert("Please enter a location to search.");
        return;
      }
      searchPlaces(query);
    });
  </script>
</body>
</html>
