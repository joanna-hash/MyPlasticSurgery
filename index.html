<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>네이버 지도 검색 + 자동완성</title>

  <!-- Naver Maps API (Geocoder + Places API 포함) -->
  <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=YOUR_CLIENT_ID&submodules=geocoder,places&language=ko"></script>

  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Pretendard', sans-serif;
    }
    #map {
      width: 100%;
      height: 75vh;
    }
    #search-box {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 999;
    }
    #search-input {
      width: 280px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #search-button {
      background-color: #03c75a;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    #search-button:hover {
      background-color: #02b150;
    }

    #results {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      width: 330px;
      max-height: 250px;
      overflow-y: auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      z-index: 998;
      display: none;
    }
    .result-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    .result-item:hover {
      background-color: #f8f8f8;
    }
    .result-title {
      font-weight: 600;
    }
    .result-address {
      font-size: 13px;
      color: #555;
    }
  </style>
</head>

<body>
  <!-- 지도 검색창 -->
  <div id="search-box">
    <input type="text" id="search-input" placeholder="검색할 장소를 입력하세요 (예: 카페, 서울시청 등)" />
    <button id="search-button">검색</button>
  </div>

  <!-- 검색 결과 리스트 -->
  <div id="results"></div>

  <!-- 지도 -->
  <div id="map"></div>

  <script>
    var map = new naver.maps.Map("map", {
      center: new naver.maps.LatLng(37.5665, 126.9780),
      zoom: 11
    });

    var markers = [];
    var infowindows = [];

    // 지도 위 마커/정보창 모두 제거
    function clearMap() {
      markers.forEach(function(m) { m.setMap(null); });
      infowindows.forEach(function(iw) { iw.close(); });
      markers = [];
      infowindows = [];
    }

    // 장소 검색
    function searchPlaces(keyword) {
      var ps = new naver.maps.Service();
      ps.search(keyword, function(status, response) {
        if (status !== naver.maps.Service.Status.OK) {
          alert("검색 결과가 없습니다.");
          return;
        }

        var places = response.v2.addresses;
        displayResults(places);
      });
    }

    // 검색 결과 리스트 출력
    function displayResults(results) {
      var resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";
      clearMap();

      if (results.length === 0) {
        resultsDiv.style.display = "none";
        alert("검색 결과가 없습니다.");
        return;
      }

      resultsDiv.style.display = "block";
      results.forEach(function(place, index) {
        var item = document.createElement("div");
        item.className = "result-item";
        item.innerHTML = `
          <div class="result-title">${place.roadAddress || place.jibunAddress}</div>
          <div class="result-address">(${place.y}, ${place.x})</div>
        `;
        item.addEventListener("click", function() {
          focusPlace(place);
        });
        resultsDiv.appendChild(item);
      });
    }

    // 특정 장소에 포커스 (지도 이동 + 마커 + 정보창)
    function focusPlace(place) {
      var lat = parseFloat(place.y);
      var lng = parseFloat(place.x);
      var location = new naver.maps.LatLng(lat, lng);

      map.setCenter(location);
      map.setZoom(15);

      clearMap();

      var marker = new naver.maps.Marker({
        position: location,
        map: map
      });
      markers.push(marker);

      var infoContent = `
        <div style="padding:10px;max-width:200px;">
          <h4 style="margin:0 0 5px;">${place.roadAddress || place.jibunAddress}</h4>
          <p>위도: ${lat.toFixed(6)}<br>경도: ${lng.toFixed(6)}</p>
        </div>
      `;

      var infowindow = new naver.maps.InfoWindow({
        content: infoContent,
        backgroundColor: "#fff",
        borderColor: "#03c75a",
        borderWidth: 3,
        anchorSize: new naver.maps.Size(20, 20)
      });

      infowindow.open(map, marker);
      infowindows.push(infowindow);

      document.getElementById("results").style.display = "none";
    }

    // 자동완성 기능
    var autocompleteTimer;
    document.getElementById("search-input").addEventListener("input", function() {
      clearTimeout(autocompleteTimer);
      var query = this.value.trim();
      if (!query) {
        document.getElementById("results").style.display = "none";
        return;
      }

      autocompleteTimer = setTimeout(function() {
        naver.maps.Service.geocode({ query: query }, function(status, response) {
          if (status !== naver.maps.Service.Status.OK) return;

          var results = response.v2.addresses.slice(0, 5); // 상위 5개만 자동완성 표시
          displayResults(results);
        });
      }, 300);
    });

    // 검색 버튼 클릭
    document.getElementById("search-button").addEventListener("click", function() {
      var query = document.getElementById("search-input").value.trim();
      if (!query) {
        alert("검색어를 입력해주세요.");
        return;
      }
      searchPlaces(query);
    });
  </script>
</body>
</html>
